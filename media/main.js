"use strict";(()=>{var me=Object.create;var ne=Object.defineProperty;var he=Object.getOwnPropertyDescriptor;var xe=Object.getOwnPropertyNames;var Be=Object.getPrototypeOf,be=Object.prototype.hasOwnProperty;var T=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports);var we=(t,e,r,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let a of xe(e))!be.call(t,a)&&a!==r&&ne(t,a,{get:()=>e[a],enumerable:!(n=he(e,a))||n.enumerable});return t};var Ae=(t,e,r)=>(r=t!=null?me(Be(t)):{},we(e||!t||!t.__esModule?ne(r,"default",{value:t,enumerable:!0}):r,t));var Y=T(k=>{"use strict";Object.defineProperty(k,"__esModule",{value:!0});k.loop=k.conditional=k.parse=void 0;var _e=function t(e,r){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:n;if(Array.isArray(r))r.forEach(function(d){return t(e,d,n,a)});else if(typeof r=="function")r(e,n,a,t);else{var i=Object.keys(r)[0];Array.isArray(r[i])?(a[i]={},t(e,r[i],n,a[i])):a[i]=r[i](e,n,a,t)}return n};k.parse=_e;var Se=function(e,r){return function(n,a,i,d){r(n,a,i)&&d(n,e,a,i)}};k.conditional=Se;var ke=function(e,r){return function(n,a,i,d){for(var o=[],l=n.pos;r(n,a,i);){var c={};if(d(n,e,a,c),n.pos===l)break;l=n.pos,o.push(c)}return o}};k.loop=ke});var ee=T(p=>{"use strict";Object.defineProperty(p,"__esModule",{value:!0});p.readBits=p.readArray=p.readUnsigned=p.readString=p.peekBytes=p.readBytes=p.peekByte=p.readByte=p.buildStream=void 0;var Ce=function(e){return{data:e,pos:0}};p.buildStream=Ce;var ae=function(){return function(e){return e.data[e.pos++]}};p.readByte=ae;var Ee=function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return function(r){return r.data[r.pos+e]}};p.peekByte=Ee;var j=function(e){return function(r){return r.data.subarray(r.pos,r.pos+=e)}};p.readBytes=j;var Me=function(e){return function(r){return r.data.subarray(r.pos,r.pos+e)}};p.peekBytes=Me;var Fe=function(e){return function(r){return Array.from(j(e)(r)).map(function(n){return String.fromCharCode(n)}).join("")}};p.readString=Fe;var Ie=function(e){return function(r){var n=j(2)(r);return e?(n[1]<<8)+n[0]:(n[0]<<8)+n[1]}};p.readUnsigned=Ie;var Ue=function(e,r){return function(n,a,i){for(var d=typeof r=="function"?r(n,a,i):r,o=j(e),l=new Array(d),c=0;c<d;c++)l[c]=o(n);return l}};p.readArray=Ue;var Te=function(e,r,n){for(var a=0,i=0;i<n;i++)a+=e[r+i]&&Math.pow(2,n-i-1);return a},ze=function(e){return function(r){for(var n=ae()(r),a=new Array(8),i=0;i<8;i++)a[7-i]=!!(n&1<<i);return Object.keys(e).reduce(function(d,o){var l=e[o];return l.length?d[o]=Te(a,l.index,l.length):d[o]=a[l.index],d},{})}};p.readBits=ze});var ie=T(R=>{"use strict";Object.defineProperty(R,"__esModule",{value:!0});R.default=void 0;var C=Y(),s=ee(),N={blocks:function(e){for(var r=0,n=[],a=e.data.length,i=0,d=(0,s.readByte)()(e);d!==r&&d;d=(0,s.readByte)()(e)){if(e.pos+d>=a){var o=a-e.pos;n.push((0,s.readBytes)(o)(e)),i+=o;break}n.push((0,s.readBytes)(d)(e)),i+=d}for(var l=new Uint8Array(i),c=0,f=0;f<n.length;f++)l.set(n[f],c),c+=n[f].length;return l}},Le=(0,C.conditional)({gce:[{codes:(0,s.readBytes)(2)},{byteSize:(0,s.readByte)()},{extras:(0,s.readBits)({future:{index:0,length:3},disposal:{index:3,length:3},userInput:{index:6},transparentColorGiven:{index:7}})},{delay:(0,s.readUnsigned)(!0)},{transparentColorIndex:(0,s.readByte)()},{terminator:(0,s.readByte)()}]},function(t){var e=(0,s.peekBytes)(2)(t);return e[0]===33&&e[1]===249}),Pe=(0,C.conditional)({image:[{code:(0,s.readByte)()},{descriptor:[{left:(0,s.readUnsigned)(!0)},{top:(0,s.readUnsigned)(!0)},{width:(0,s.readUnsigned)(!0)},{height:(0,s.readUnsigned)(!0)},{lct:(0,s.readBits)({exists:{index:0},interlaced:{index:1},sort:{index:2},future:{index:3,length:2},size:{index:5,length:3}})}]},(0,C.conditional)({lct:(0,s.readArray)(3,function(t,e,r){return Math.pow(2,r.descriptor.lct.size+1)})},function(t,e,r){return r.descriptor.lct.exists}),{data:[{minCodeSize:(0,s.readByte)()},N]}]},function(t){return(0,s.peekByte)()(t)===44}),De=(0,C.conditional)({text:[{codes:(0,s.readBytes)(2)},{blockSize:(0,s.readByte)()},{preData:function(e,r,n){return(0,s.readBytes)(n.text.blockSize)(e)}},N]},function(t){var e=(0,s.peekBytes)(2)(t);return e[0]===33&&e[1]===1}),qe=(0,C.conditional)({application:[{codes:(0,s.readBytes)(2)},{blockSize:(0,s.readByte)()},{id:function(e,r,n){return(0,s.readString)(n.blockSize)(e)}},N]},function(t){var e=(0,s.peekBytes)(2)(t);return e[0]===33&&e[1]===255}),He=(0,C.conditional)({comment:[{codes:(0,s.readBytes)(2)},N]},function(t){var e=(0,s.peekBytes)(2)(t);return e[0]===33&&e[1]===254}),Ge=[{header:[{signature:(0,s.readString)(3)},{version:(0,s.readString)(3)}]},{lsd:[{width:(0,s.readUnsigned)(!0)},{height:(0,s.readUnsigned)(!0)},{gct:(0,s.readBits)({exists:{index:0},resolution:{index:1,length:3},sort:{index:4},size:{index:5,length:3}})},{backgroundColorIndex:(0,s.readByte)()},{pixelAspectRatio:(0,s.readByte)()}]},(0,C.conditional)({gct:(0,s.readArray)(3,function(t,e){return Math.pow(2,e.lsd.gct.size+1)})},function(t,e){return e.lsd.gct.exists}),{frames:(0,C.loop)([Le,qe,He,Pe,De],function(t){var e=(0,s.peekByte)()(t);return e===33||e===44})}],Oe=Ge;R.default=Oe});var oe=T(W=>{"use strict";Object.defineProperty(W,"__esModule",{value:!0});W.deinterlace=void 0;var je=function(e,r){for(var n=new Array(e.length),a=e.length/r,i=function(I,h){var u=e.slice(h*r,(h+1)*r);n.splice.apply(n,[I*r,r].concat(u))},d=[0,4,2,1],o=[8,8,4,2],l=0,c=0;c<4;c++)for(var f=d[c];f<a;f+=o[c])i(f,l),l++;return n};W.deinterlace=je});var se=T($=>{"use strict";Object.defineProperty($,"__esModule",{value:!0});$.lzw=void 0;var Ne=function(e,r,n){var a=4096,i=-1,d=n,o,l,c,f,B,I,h,w,u,A,x,_,U,S,O,G,P=new Array(n),g=new Array(a),y=new Array(a),m=new Array(a+1);for(_=e,l=1<<_,B=l+1,o=l+2,h=i,f=_+1,c=(1<<f)-1,u=0;u<l;u++)g[u]=0,y[u]=u;var x,w,ye,U,S,G,O;for(x=w=ye=U=S=G=O=0,A=0;A<d;){if(S===0){if(w<f){x+=r[O]<<w,w+=8,O++;continue}if(u=x&c,x>>=f,w-=f,u>o||u==B)break;if(u==l){f=_+1,c=(1<<f)-1,o=l+2,h=i;continue}if(h==i){m[S++]=y[u],h=u,U=u;continue}for(I=u,u==o&&(m[S++]=U,u=h);u>l;)m[S++]=y[u],u=g[u];U=y[u]&255,m[S++]=U,o<a&&(g[o]=h,y[o]=U,o++,!(o&c)&&o<a&&(f++,c+=o)),h=I}S--,P[G++]=m[S],A++}for(A=G;A<d;A++)P[A]=0;return P};$.lzw=Ne});var le=T(E=>{"use strict";Object.defineProperty(E,"__esModule",{value:!0});E.decompressFrames=E.decompressFrame=E.parseGIF=void 0;var Re=Ve(ie()),We=Y(),$e=ee(),Xe=oe(),Ke=se();function Ve(t){return t&&t.__esModule?t:{default:t}}var Ze=function(e){var r=new Uint8Array(e);return(0,We.parse)((0,$e.buildStream)(r),Re.default)};E.parseGIF=Ze;var Je=function(e){for(var r=e.pixels.length,n=new Uint8ClampedArray(r*4),a=0;a<r;a++){var i=a*4,d=e.pixels[a],o=e.colorTable[d]||[0,0,0];n[i]=o[0],n[i+1]=o[1],n[i+2]=o[2],n[i+3]=d!==e.transparentIndex?255:0}return n},de=function(e,r,n){if(!e.image){console.warn("gif frame does not have associated image.");return}var a=e.image,i=a.descriptor.width*a.descriptor.height,d=(0,Ke.lzw)(a.data.minCodeSize,a.data.blocks,i);a.descriptor.lct.interlaced&&(d=(0,Xe.deinterlace)(d,a.descriptor.width));var o={pixels:d,dims:{top:e.image.descriptor.top,left:e.image.descriptor.left,width:e.image.descriptor.width,height:e.image.descriptor.height}};return a.descriptor.lct&&a.descriptor.lct.exists?o.colorTable=a.lct:o.colorTable=r,e.gce&&(o.delay=(e.gce.delay||10)*10,o.disposalType=e.gce.extras.disposal,e.gce.extras.transparentColorGiven&&(o.transparentIndex=e.gce.transparentColorIndex)),n&&(o.patch=Je(o)),o};E.decompressFrame=de;var Qe=function(e,r){return e.frames.filter(function(n){return n.image}).map(function(n){return de(n,e.gct,r)})};E.decompressFrames=Qe});var J=Ae(le()),Ye=acquireVsCodeApi?.(),F=document.getElementById("canvas"),et=F.getContext("2d"),re=document.getElementById("play"),tt=document.getElementById("prev"),rt=document.getElementById("next"),V=document.getElementById("progress"),ce=document.getElementById("speed"),te=document.getElementById("info"),v=[],b=0,L=!1,X=1,Z=null,D=0,K=0,ue=0,nt=2e3,M=0,z=0;function q(t){te.textContent=t}function at(t){let e=atob(t),r=e.length,n=new Uint8Array(r);for(let a=0;a<r;a++)n[a]=e.charCodeAt(a);return n.buffer}async function fe(t){try{q("\u89E3\u6790\u4E2D...");let e=at(t),r=(0,J.parseGIF)(e),n=(0,J.decompressFrames)(r,!0);if(!n.length){q("\u65E0\u6709\u6548\u5E27"),v=[];return}M=r.lsd?.width||n[0].dims.width,z=r.lsd?.height||n[0].dims.height;let a=[],i=new Uint8ClampedArray(M*z*4),d=null;for(let l=0;l<n.length;l++){let c=n[l],f=c.disposalType;f===3?d=new Uint8ClampedArray(i):d=null;let B=new Uint8ClampedArray(i),{left:I,top:h,width:u,height:A}=c.dims,_=c.patch;for(let g=0;g<A;g++)for(let y=0;y<u;y++){let m=(g*u+y)*4,x=_[m+3];if(x===0)continue;let w=((h+g)*M+(I+y))*4;B[w]=_[m],B[w+1]=_[m+1],B[w+2]=_[m+2],B[w+3]=x}let P=new ImageData(B,M,z);switch(a.push({delay:Math.max(10,c.delay||0),imageData:P}),f){case 2:{let g=new Uint8ClampedArray(B);for(let y=0;y<A;y++)for(let m=0;m<u;m++){let x=((h+y)*M+(I+m))*4;g[x]=0,g[x+1]=0,g[x+2]=0,g[x+3]=0}i=g;break}case 3:{d?i=new Uint8ClampedArray(d):i=new Uint8ClampedArray(B);break}case 0:case 1:default:i=new Uint8ClampedArray(B)}}v=a,ue=v.reduce((l,c)=>l+c.delay,0),V.max=String(v.length-1),F.width=v[0].imageData.width,F.height=v[0].imageData.height,pe(),b=0,H();let o="";v.length>nt&&(o=" \u26A0\u5927\u91CF\u5E27, \u6027\u80FD\u53EF\u80FD\u4E0B\u964D"),q(`${v.length} \u5E27 / ${(ue/1e3).toFixed(2)}s${o}`),L||ge()}catch(e){console.error(e),q("\u89E3\u6790\u5931\u8D25")}}function H(){if(!v.length)return;let t=v[b];et.putImageData(t.imageData,0,0),V.value=String(b)}function pe(){if(!M||!z)return;let t=F.parentElement;if(!t)return;let e=t.clientWidth,r=t.clientHeight;if(e<=0||r<=0)return;let n=Math.min(e/M,r/z),a=Math.max(1,Math.floor(M*n)),i=Math.max(1,Math.floor(z*n));F.style.width=a+"px",F.style.height=i+"px"}var it=new ResizeObserver(pe);F.parentElement&&it.observe(F.parentElement);function ve(t){if(!L)return;D||(D=t);let e=t-D;D=t,K+=e*X;let r=0;for(;K>=v[b].delay&&(K-=v[b].delay,b=(b+1)%v.length,r++,!(r>10)););H(),L&&(Z=requestAnimationFrame(ve))}function ge(){v.length&&(L=!0,re.textContent="\u23F8",D=0,K=0,Z=requestAnimationFrame(ve))}function Q(){L=!1,re.textContent="\u25B6",Z&&cancelAnimationFrame(Z)}re.addEventListener("click",()=>{L?Q():ge()});tt.addEventListener("click",()=>{Q(),v.length&&(b=(b-1+v.length)%v.length,H())});rt.addEventListener("click",()=>{Q(),v.length&&(b=(b+1)%v.length,H())});V.addEventListener("input",()=>{Q(),b=Number(V.value),H()});ce.addEventListener("change",()=>{let t=Number(ce.value);t<.1?X=.1:t>4?X=4:X=t});window.addEventListener("message",t=>{let e=t.data;e.type==="reload"&&fe(e.data)});window.__initialGifBase64?fe(window.__initialGifBase64):Ye?.postMessage({type:"requestBytes"});window.__isLargeGif&&q((te.textContent?te.textContent+" ":"")+"\u26A0 \u6587\u4EF6\u8F83\u5927\uFF0C\u89E3\u6790\u53EF\u80FD\u8017\u65F6");})();
//# sourceMappingURL=main.js.map
