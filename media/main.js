"use strict";(()=>{var xe=Object.create;var se=Object.defineProperty;var Be=Object.getOwnPropertyDescriptor;var we=Object.getOwnPropertyNames;var be=Object.getPrototypeOf,Ae=Object.prototype.hasOwnProperty;var P=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports);var Se=(t,e,r,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let a of we(e))!Ae.call(t,a)&&a!==r&&se(t,a,{get:()=>e[a],enumerable:!(n=Be(e,a))||n.enumerable});return t};var _e=(t,e,r)=>(r=t!=null?xe(be(t)):{},Se(e||!t||!t.__esModule?se(r,"default",{value:t,enumerable:!0}):r,t));var Y=P(E=>{"use strict";Object.defineProperty(E,"__esModule",{value:!0});E.loop=E.conditional=E.parse=void 0;var ke=function t(e,r){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:n;if(Array.isArray(r))r.forEach(function(i){return t(e,i,n,a)});else if(typeof r=="function")r(e,n,a,t);else{var o=Object.keys(r)[0];Array.isArray(r[o])?(a[o]={},t(e,r[o],n,a[o])):a[o]=r[o](e,n,a,t)}return n};E.parse=ke;var Ce=function(e,r){return function(n,a,o,i){r(n,a,o)&&i(n,e,a,o)}};E.conditional=Ce;var Ee=function(e,r){return function(n,a,o,i){for(var s=[],l=n.pos;r(n,a,o);){var c={};if(i(n,e,a,c),n.pos===l)break;l=n.pos,s.push(c)}return s}};E.loop=Ee});var ee=P(g=>{"use strict";Object.defineProperty(g,"__esModule",{value:!0});g.readBits=g.readArray=g.readUnsigned=g.readString=g.peekBytes=g.readBytes=g.peekByte=g.readByte=g.buildStream=void 0;var Ie=function(e){return{data:e,pos:0}};g.buildStream=Ie;var de=function(){return function(e){return e.data[e.pos++]}};g.readByte=de;var Me=function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return function(r){return r.data[r.pos+e]}};g.peekByte=Me;var R=function(e){return function(r){return r.data.subarray(r.pos,r.pos+=e)}};g.readBytes=R;var Fe=function(e){return function(r){return r.data.subarray(r.pos,r.pos+e)}};g.peekBytes=Fe;var Ue=function(e){return function(r){return Array.from(R(e)(r)).map(function(n){return String.fromCharCode(n)}).join("")}};g.readString=Ue;var Le=function(e){return function(r){var n=R(2)(r);return e?(n[1]<<8)+n[0]:(n[0]<<8)+n[1]}};g.readUnsigned=Le;var Te=function(e,r){return function(n,a,o){for(var i=typeof r=="function"?r(n,a,o):r,s=R(e),l=new Array(i),c=0;c<i;c++)l[c]=s(n);return l}};g.readArray=Te;var De=function(e,r,n){for(var a=0,o=0;o<n;o++)a+=e[r+o]&&Math.pow(2,n-o-1);return a},Pe=function(e){return function(r){for(var n=de()(r),a=new Array(8),o=0;o<8;o++)a[7-o]=!!(n&1<<o);return Object.keys(e).reduce(function(i,s){var l=e[s];return l.length?i[s]=De(a,l.index,l.length):i[s]=a[l.index],i},{})}};g.readBits=Pe});var le=P(X=>{"use strict";Object.defineProperty(X,"__esModule",{value:!0});X.default=void 0;var I=Y(),d=ee(),K={blocks:function(e){for(var r=0,n=[],a=e.data.length,o=0,i=(0,d.readByte)()(e);i!==r&&i;i=(0,d.readByte)()(e)){if(e.pos+i>=a){var s=a-e.pos;n.push((0,d.readBytes)(s)(e)),o+=s;break}n.push((0,d.readBytes)(i)(e)),o+=i}for(var l=new Uint8Array(o),c=0,p=0;p<n.length;p++)l.set(n[p],c),c+=n[p].length;return l}},Ne=(0,I.conditional)({gce:[{codes:(0,d.readBytes)(2)},{byteSize:(0,d.readByte)()},{extras:(0,d.readBits)({future:{index:0,length:3},disposal:{index:3,length:3},userInput:{index:6},transparentColorGiven:{index:7}})},{delay:(0,d.readUnsigned)(!0)},{transparentColorIndex:(0,d.readByte)()},{terminator:(0,d.readByte)()}]},function(t){var e=(0,d.peekBytes)(2)(t);return e[0]===33&&e[1]===249}),ze=(0,I.conditional)({image:[{code:(0,d.readByte)()},{descriptor:[{left:(0,d.readUnsigned)(!0)},{top:(0,d.readUnsigned)(!0)},{width:(0,d.readUnsigned)(!0)},{height:(0,d.readUnsigned)(!0)},{lct:(0,d.readBits)({exists:{index:0},interlaced:{index:1},sort:{index:2},future:{index:3,length:2},size:{index:5,length:3}})}]},(0,I.conditional)({lct:(0,d.readArray)(3,function(t,e,r){return Math.pow(2,r.descriptor.lct.size+1)})},function(t,e,r){return r.descriptor.lct.exists}),{data:[{minCodeSize:(0,d.readByte)()},K]}]},function(t){return(0,d.peekByte)()(t)===44}),qe=(0,I.conditional)({text:[{codes:(0,d.readBytes)(2)},{blockSize:(0,d.readByte)()},{preData:function(e,r,n){return(0,d.readBytes)(n.text.blockSize)(e)}},K]},function(t){var e=(0,d.peekBytes)(2)(t);return e[0]===33&&e[1]===1}),He=(0,I.conditional)({application:[{codes:(0,d.readBytes)(2)},{blockSize:(0,d.readByte)()},{id:function(e,r,n){return(0,d.readString)(n.blockSize)(e)}},K]},function(t){var e=(0,d.peekBytes)(2)(t);return e[0]===33&&e[1]===255}),Ge=(0,I.conditional)({comment:[{codes:(0,d.readBytes)(2)},K]},function(t){var e=(0,d.peekBytes)(2)(t);return e[0]===33&&e[1]===254}),Oe=[{header:[{signature:(0,d.readString)(3)},{version:(0,d.readString)(3)}]},{lsd:[{width:(0,d.readUnsigned)(!0)},{height:(0,d.readUnsigned)(!0)},{gct:(0,d.readBits)({exists:{index:0},resolution:{index:1,length:3},sort:{index:4},size:{index:5,length:3}})},{backgroundColorIndex:(0,d.readByte)()},{pixelAspectRatio:(0,d.readByte)()}]},(0,I.conditional)({gct:(0,d.readArray)(3,function(t,e){return Math.pow(2,e.lsd.gct.size+1)})},function(t,e){return e.lsd.gct.exists}),{frames:(0,I.loop)([Ne,He,Ge,ze,qe],function(t){var e=(0,d.peekByte)()(t);return e===33||e===44})}],je=Oe;X.default=je});var ce=P($=>{"use strict";Object.defineProperty($,"__esModule",{value:!0});$.deinterlace=void 0;var Re=function(e,r){for(var n=new Array(e.length),a=e.length/r,o=function(F,B){var u=e.slice(B*r,(B+1)*r);n.splice.apply(n,[F*r,r].concat(u))},i=[0,4,2,1],s=[8,8,4,2],l=0,c=0;c<4;c++)for(var p=i[c];p<a;p+=s[c])o(p,l),l++;return n};$.deinterlace=Re});var ue=P(W=>{"use strict";Object.defineProperty(W,"__esModule",{value:!0});W.lzw=void 0;var Ke=function(e,r,n){var a=4096,o=-1,i=n,s,l,c,p,b,F,B,A,u,S,w,k,U,C,j,O,z=new Array(n),m=new Array(a),h=new Array(a),x=new Array(a+1);for(k=e,l=1<<k,b=l+1,s=l+2,B=o,p=k+1,c=(1<<p)-1,u=0;u<l;u++)m[u]=0,h[u]=u;var w,A,he,U,C,O,j;for(w=A=he=U=C=O=j=0,S=0;S<i;){if(C===0){if(A<p){w+=r[j]<<A,A+=8,j++;continue}if(u=w&c,w>>=p,A-=p,u>s||u==b)break;if(u==l){p=k+1,c=(1<<p)-1,s=l+2,B=o;continue}if(B==o){x[C++]=h[u],B=u,U=u;continue}for(F=u,u==s&&(x[C++]=U,u=B);u>l;)x[C++]=h[u],u=m[u];U=h[u]&255,x[C++]=U,s<a&&(m[s]=B,h[s]=U,s++,!(s&c)&&s<a&&(p++,c+=s)),B=F}C--,z[O++]=x[C],S++}for(S=O;S<i;S++)z[S]=0;return z};W.lzw=Ke});var pe=P(M=>{"use strict";Object.defineProperty(M,"__esModule",{value:!0});M.decompressFrames=M.decompressFrame=M.parseGIF=void 0;var Xe=Je(le()),$e=Y(),We=ee(),Ve=ce(),Ze=ue();function Je(t){return t&&t.__esModule?t:{default:t}}var Qe=function(e){var r=new Uint8Array(e);return(0,$e.parse)((0,We.buildStream)(r),Xe.default)};M.parseGIF=Qe;var Ye=function(e){for(var r=e.pixels.length,n=new Uint8ClampedArray(r*4),a=0;a<r;a++){var o=a*4,i=e.pixels[a],s=e.colorTable[i]||[0,0,0];n[o]=s[0],n[o+1]=s[1],n[o+2]=s[2],n[o+3]=i!==e.transparentIndex?255:0}return n},fe=function(e,r,n){if(!e.image){console.warn("gif frame does not have associated image.");return}var a=e.image,o=a.descriptor.width*a.descriptor.height,i=(0,Ze.lzw)(a.data.minCodeSize,a.data.blocks,o);a.descriptor.lct.interlaced&&(i=(0,Ve.deinterlace)(i,a.descriptor.width));var s={pixels:i,dims:{top:e.image.descriptor.top,left:e.image.descriptor.left,width:e.image.descriptor.width,height:e.image.descriptor.height}};return a.descriptor.lct&&a.descriptor.lct.exists?s.colorTable=a.lct:s.colorTable=r,e.gce&&(s.delay=(e.gce.delay||10)*10,s.disposalType=e.gce.extras.disposal,e.gce.extras.transparentColorGiven&&(s.transparentIndex=e.gce.transparentColorIndex)),n&&(s.patch=Ye(s)),s};M.decompressFrame=fe;var et=function(e,r){return e.frames.filter(function(n){return n.image}).map(function(n){return fe(n,e.gct,r)})};M.decompressFrames=et});var Q=_e(pe()),ve=acquireVsCodeApi?.(),re=document.getElementById("canvas"),tt=re.getContext("2d"),ie=document.getElementById("play"),rt=document.getElementById("prev"),nt=document.getElementById("next"),Z=document.getElementById("progress"),_=document.getElementById("speed"),ne=document.getElementById("info"),G=document.getElementById("loadingOverlay");function ae(t="\u52A0\u8F7D\u4E2D..."){if(G){let e=G.querySelector(".loading-text");e&&(e.textContent=t),G.style.display="flex"}}function at(){G&&(G.style.display="none")}var f=[],y=0,T=!1,v=window.__initialPlaybackSpeed&&!isNaN(window.__initialPlaybackSpeed)?Number(window.__initialPlaybackSpeed):1,J=null,H=0,V=0,ge=0,it=2e3,q=0,te=0;function N(t){ne.textContent=t}function ot(t){let e=atob(t),r=e.length,n=new Uint8Array(r);for(let a=0;a<r;a++)n[a]=e.charCodeAt(a);return n.buffer}async function ye(t){try{ae("\u89E3\u6790\u4E2D..."),N("\u89E3\u6790\u4E2D...");let e=ot(t),r=(0,Q.parseGIF)(e),n=(0,Q.decompressFrames)(r,!0);if(!n.length){N("\u65E0\u6709\u6548\u5E27"),f=[];return}q=r.lsd?.width||n[0].dims.width,te=r.lsd?.height||n[0].dims.height;let a=[],o=new Uint8ClampedArray(q*te*4),i=null;for(let l=0;l<n.length;l++){let c=n[l],p=c.disposalType;p===3?i=new Uint8ClampedArray(o):i=null;let b=new Uint8ClampedArray(o),{left:F,top:B,width:u,height:S}=c.dims,k=c.patch;for(let m=0;m<S;m++)for(let h=0;h<u;h++){let x=(m*u+h)*4,w=k[x+3];if(w===0)continue;let A=((B+m)*q+(F+h))*4;b[A]=k[x],b[A+1]=k[x+1],b[A+2]=k[x+2],b[A+3]=w}let z=new ImageData(b,q,te);switch(a.push({delay:Math.max(10,c.delay||0),imageData:z}),p){case 2:{let m=new Uint8ClampedArray(b);for(let h=0;h<S;h++)for(let x=0;x<u;x++){let w=((B+h)*q+(F+x))*4;m[w]=0,m[w+1]=0,m[w+2]=0,m[w+3]=0}o=m;break}case 3:{i?o=new Uint8ClampedArray(i):o=new Uint8ClampedArray(b);break}case 0:case 1:default:o=new Uint8ClampedArray(b)}}f=a,ge=f.reduce((l,c)=>l+c.delay,0),Z.max=String(f.length-1),re.width=f[0].imageData.width,re.height=f[0].imageData.height,y=0,D();let s="";f.length>it&&(s=" \u26A0\u5927\u91CF\u5E27, \u6027\u80FD\u53EF\u80FD\u4E0B\u964D"),N(`${f.length} \u5E27 / ${(ge/1e3).toFixed(2)}s${s}`),T||oe(),at()}catch(e){console.error(e),N("\u89E3\u6790\u5931\u8D25"),ae("\u89E3\u6790\u5931\u8D25")}}function D(){if(!f.length)return;let t=f[y];tt.putImageData(t.imageData,0,0),Z.value=String(y)}function me(t){if(!T)return;H||(H=t);let e=t-H;H=t,V+=e*v;let r=0;for(;V>=f[y].delay&&(V-=f[y].delay,y=(y+1)%f.length,r++,!(r>10)););D(),T&&(J=requestAnimationFrame(me))}function oe(){f.length&&(T=!0,ie.textContent="\u23F8",H=0,V=0,J=requestAnimationFrame(me))}function L(){T=!1,ie.textContent="\u25B6",J&&cancelAnimationFrame(J)}ie.addEventListener("click",()=>{T?L():oe()});rt.addEventListener("click",()=>{L(),f.length&&(y=(y-1+f.length)%f.length,D())});nt.addEventListener("click",()=>{L(),f.length&&(y=(y+1)%f.length,D())});Z.addEventListener("input",()=>{L(),y=Number(Z.value),D()});_.addEventListener("change",()=>{let t=Number(_.value);t<.1?v=.1:t>4?v=4:v=t});window.addEventListener("message",t=>{let e=t.data;e.type==="reload"?ye(e.data):e.type==="copyResult"&&(e.ok||(N("\u590D\u5236\u5931\u8D25"),console.error(e.message)))});window.addEventListener("keydown",t=>{let e=t.target?.tagName;if(!(e==="INPUT"||e==="SELECT"||e==="TEXTAREA"||t.target?.isContentEditable))if(t.code==="Space")t.preventDefault(),T?L():oe();else if(t.code==="ArrowLeft")t.preventDefault(),L(),f.length&&(y=(y-1+f.length)%f.length,D());else if(t.code==="ArrowRight")t.preventDefault(),L(),f.length&&(y=(y+1)%f.length,D());else if(t.code==="ArrowUp"){t.preventDefault();let r=Array.from(_.options).map(i=>Number(i.value)).sort((i,s)=>i-s),n=r.findIndex(i=>i>=v),a;n===-1?a=r[0]:r[n]===v?a=r[Math.min(r.length-1,n+1)]:a=r[n],v=a,Array.from(_.options).find(i=>Number(i.value)===v)&&(_.value=String(v))}else if(t.code==="ArrowDown"){t.preventDefault();let r=Array.from(_.options).map(i=>Number(i.value)).sort((i,s)=>i-s),n=r.findIndex(i=>i>=v),a;n===-1?a=r[0]:(r[n],a=r[Math.max(0,n-1)]),v=a,Array.from(_.options).find(i=>Number(i.value)===v)&&(_.value=String(v))}else(t.metaKey||t.ctrlKey)&&t.code==="KeyC"&&ve?.postMessage({type:"copyGif"})});window.__initialGifBase64?ye(window.__initialGifBase64):(ae("Loading..."),ve?.postMessage({type:"requestBytes"}));var st=Array.from(_.options).find(t=>Number(t.value)===v);st&&(_.value=String(v));window.__isLargeGif&&N((ne.textContent?ne.textContent+" ":"")+"\u26A0 \u6587\u4EF6\u8F83\u5927\uFF0C\u89E3\u6790\u53EF\u80FD\u8017\u65F6");})();
//# sourceMappingURL=main.js.map
