"use strict";(()=>{var ye=Object.create;var ie=Object.defineProperty;var he=Object.getOwnPropertyDescriptor;var xe=Object.getOwnPropertyNames;var Be=Object.getPrototypeOf,be=Object.prototype.hasOwnProperty;var H=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports);var we=(t,e,r,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let a of xe(e))!be.call(t,a)&&a!==r&&ie(t,a,{get:()=>e[a],enumerable:!(n=he(e,a))||n.enumerable});return t};var Ae=(t,e,r)=>(r=t!=null?ye(Be(t)):{},we(e||!t||!t.__esModule?ie(r,"default",{value:t,enumerable:!0}):r,t));var ee=H(M=>{"use strict";Object.defineProperty(M,"__esModule",{value:!0});M.loop=M.conditional=M.parse=void 0;var Se=function t(e,r){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:n;if(Array.isArray(r))r.forEach(function(i){return t(e,i,n,a)});else if(typeof r=="function")r(e,n,a,t);else{var o=Object.keys(r)[0];Array.isArray(r[o])?(a[o]={},t(e,r[o],n,a[o])):a[o]=r[o](e,n,a,t)}return n};M.parse=Se;var _e=function(e,r){return function(n,a,o,i){r(n,a,o)&&i(n,e,a,o)}};M.conditional=_e;var Ee=function(e,r){return function(n,a,o,i){for(var s=[],l=n.pos;r(n,a,o);){var c={};if(i(n,e,a,c),n.pos===l)break;l=n.pos,s.push(c)}return s}};M.loop=Ee});var te=H(g=>{"use strict";Object.defineProperty(g,"__esModule",{value:!0});g.readBits=g.readArray=g.readUnsigned=g.readString=g.peekBytes=g.readBytes=g.peekByte=g.readByte=g.buildStream=void 0;var Me=function(e){return{data:e,pos:0}};g.buildStream=Me;var oe=function(){return function(e){return e.data[e.pos++]}};g.readByte=oe;var ke=function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return function(r){return r.data[r.pos+e]}};g.peekByte=ke;var W=function(e){return function(r){return r.data.subarray(r.pos,r.pos+=e)}};g.readBytes=W;var Ce=function(e){return function(r){return r.data.subarray(r.pos,r.pos+e)}};g.peekBytes=Ce;var Ie=function(e){return function(r){return Array.from(W(e)(r)).map(function(n){return String.fromCharCode(n)}).join("")}};g.readString=Ie;var Fe=function(e){return function(r){var n=W(2)(r);return e?(n[1]<<8)+n[0]:(n[0]<<8)+n[1]}};g.readUnsigned=Fe;var Ue=function(e,r){return function(n,a,o){for(var i=typeof r=="function"?r(n,a,o):r,s=W(e),l=new Array(i),c=0;c<i;c++)l[c]=s(n);return l}};g.readArray=Ue;var Te=function(e,r,n){for(var a=0,o=0;o<n;o++)a+=e[r+o]&&Math.pow(2,n-o-1);return a},De=function(e){return function(r){for(var n=oe()(r),a=new Array(8),o=0;o<8;o++)a[7-o]=!!(n&1<<o);return Object.keys(e).reduce(function(i,s){var l=e[s];return l.length?i[s]=Te(a,l.index,l.length):i[s]=a[l.index],i},{})}};g.readBits=De});var se=H($=>{"use strict";Object.defineProperty($,"__esModule",{value:!0});$.default=void 0;var k=ee(),d=te(),X={blocks:function(e){for(var r=0,n=[],a=e.data.length,o=0,i=(0,d.readByte)()(e);i!==r&&i;i=(0,d.readByte)()(e)){if(e.pos+i>=a){var s=a-e.pos;n.push((0,d.readBytes)(s)(e)),o+=s;break}n.push((0,d.readBytes)(i)(e)),o+=i}for(var l=new Uint8Array(o),c=0,p=0;p<n.length;p++)l.set(n[p],c),c+=n[p].length;return l}},Le=(0,k.conditional)({gce:[{codes:(0,d.readBytes)(2)},{byteSize:(0,d.readByte)()},{extras:(0,d.readBits)({future:{index:0,length:3},disposal:{index:3,length:3},userInput:{index:6},transparentColorGiven:{index:7}})},{delay:(0,d.readUnsigned)(!0)},{transparentColorIndex:(0,d.readByte)()},{terminator:(0,d.readByte)()}]},function(t){var e=(0,d.peekBytes)(2)(t);return e[0]===33&&e[1]===249}),ze=(0,k.conditional)({image:[{code:(0,d.readByte)()},{descriptor:[{left:(0,d.readUnsigned)(!0)},{top:(0,d.readUnsigned)(!0)},{width:(0,d.readUnsigned)(!0)},{height:(0,d.readUnsigned)(!0)},{lct:(0,d.readBits)({exists:{index:0},interlaced:{index:1},sort:{index:2},future:{index:3,length:2},size:{index:5,length:3}})}]},(0,k.conditional)({lct:(0,d.readArray)(3,function(t,e,r){return Math.pow(2,r.descriptor.lct.size+1)})},function(t,e,r){return r.descriptor.lct.exists}),{data:[{minCodeSize:(0,d.readByte)()},X]}]},function(t){return(0,d.peekByte)()(t)===44}),Pe=(0,k.conditional)({text:[{codes:(0,d.readBytes)(2)},{blockSize:(0,d.readByte)()},{preData:function(e,r,n){return(0,d.readBytes)(n.text.blockSize)(e)}},X]},function(t){var e=(0,d.peekBytes)(2)(t);return e[0]===33&&e[1]===1}),He=(0,k.conditional)({application:[{codes:(0,d.readBytes)(2)},{blockSize:(0,d.readByte)()},{id:function(e,r,n){return(0,d.readString)(n.blockSize)(e)}},X]},function(t){var e=(0,d.peekBytes)(2)(t);return e[0]===33&&e[1]===255}),qe=(0,k.conditional)({comment:[{codes:(0,d.readBytes)(2)},X]},function(t){var e=(0,d.peekBytes)(2)(t);return e[0]===33&&e[1]===254}),Ne=[{header:[{signature:(0,d.readString)(3)},{version:(0,d.readString)(3)}]},{lsd:[{width:(0,d.readUnsigned)(!0)},{height:(0,d.readUnsigned)(!0)},{gct:(0,d.readBits)({exists:{index:0},resolution:{index:1,length:3},sort:{index:4},size:{index:5,length:3}})},{backgroundColorIndex:(0,d.readByte)()},{pixelAspectRatio:(0,d.readByte)()}]},(0,k.conditional)({gct:(0,d.readArray)(3,function(t,e){return Math.pow(2,e.lsd.gct.size+1)})},function(t,e){return e.lsd.gct.exists}),{frames:(0,k.loop)([Le,He,qe,ze,Pe],function(t){var e=(0,d.peekByte)()(t);return e===33||e===44})}],Ge=Ne;$.default=Ge});var de=H(K=>{"use strict";Object.defineProperty(K,"__esModule",{value:!0});K.deinterlace=void 0;var Oe=function(e,r){for(var n=new Array(e.length),a=e.length/r,o=function(T,B){var u=e.slice(B*r,(B+1)*r);n.splice.apply(n,[T*r,r].concat(u))},i=[0,4,2,1],s=[8,8,4,2],l=0,c=0;c<4;c++)for(var p=i[c];p<a;p+=s[c])o(p,l),l++;return n};K.deinterlace=Oe});var le=H(V=>{"use strict";Object.defineProperty(V,"__esModule",{value:!0});V.lzw=void 0;var je=function(e,r,n){var a=4096,o=-1,i=n,s,l,c,p,w,T,B,A,u,S,b,_,D,E,R,j,N=new Array(n),m=new Array(a),y=new Array(a),h=new Array(a+1);for(_=e,l=1<<_,w=l+1,s=l+2,B=o,p=_+1,c=(1<<p)-1,u=0;u<l;u++)m[u]=0,y[u]=u;var b,A,me,D,E,j,R;for(b=A=me=D=E=j=R=0,S=0;S<i;){if(E===0){if(A<p){b+=r[R]<<A,A+=8,R++;continue}if(u=b&c,b>>=p,A-=p,u>s||u==w)break;if(u==l){p=_+1,c=(1<<p)-1,s=l+2,B=o;continue}if(B==o){h[E++]=y[u],B=u,D=u;continue}for(T=u,u==s&&(h[E++]=D,u=B);u>l;)h[E++]=y[u],u=m[u];D=y[u]&255,h[E++]=D,s<a&&(m[s]=B,y[s]=D,s++,!(s&c)&&s<a&&(p++,c+=s)),B=T}E--,N[j++]=h[E],S++}for(S=j;S<i;S++)N[S]=0;return N};V.lzw=je});var ue=H(C=>{"use strict";Object.defineProperty(C,"__esModule",{value:!0});C.decompressFrames=C.decompressFrame=C.parseGIF=void 0;var Re=Ve(se()),We=ee(),Xe=te(),$e=de(),Ke=le();function Ve(t){return t&&t.__esModule?t:{default:t}}var Ze=function(e){var r=new Uint8Array(e);return(0,We.parse)((0,Xe.buildStream)(r),Re.default)};C.parseGIF=Ze;var Je=function(e){for(var r=e.pixels.length,n=new Uint8ClampedArray(r*4),a=0;a<r;a++){var o=a*4,i=e.pixels[a],s=e.colorTable[i]||[0,0,0];n[o]=s[0],n[o+1]=s[1],n[o+2]=s[2],n[o+3]=i!==e.transparentIndex?255:0}return n},ce=function(e,r,n){if(!e.image){console.warn("gif frame does not have associated image.");return}var a=e.image,o=a.descriptor.width*a.descriptor.height,i=(0,Ke.lzw)(a.data.minCodeSize,a.data.blocks,o);a.descriptor.lct.interlaced&&(i=(0,$e.deinterlace)(i,a.descriptor.width));var s={pixels:i,dims:{top:e.image.descriptor.top,left:e.image.descriptor.left,width:e.image.descriptor.width,height:e.image.descriptor.height}};return a.descriptor.lct&&a.descriptor.lct.exists?s.colorTable=a.lct:s.colorTable=r,e.gce&&(s.delay=(e.gce.delay||10)*10,s.disposalType=e.gce.extras.disposal,e.gce.extras.transparentColorGiven&&(s.transparentIndex=e.gce.transparentColorIndex)),n&&(s.patch=Je(s)),s};C.decompressFrame=ce;var Qe=function(e,r){return e.frames.filter(function(n){return n.image}).map(function(n){return ce(n,e.gct,r)})};C.decompressFrames=Qe});var Y=Ae(ue()),Ye=acquireVsCodeApi?.(),U=document.getElementById("canvas"),et=U.getContext("2d"),ne=document.getElementById("play"),tt=document.getElementById("prev"),rt=document.getElementById("next"),J=document.getElementById("progress"),I=document.getElementById("speed"),re=document.getElementById("info"),f=[],v=0,z=!1,x=1,Q=null,G=0,Z=0,fe=0,nt=2e3,F=0,q=0;function O(t){re.textContent=t}function at(t){let e=atob(t),r=e.length,n=new Uint8Array(r);for(let a=0;a<r;a++)n[a]=e.charCodeAt(a);return n.buffer}async function pe(t){try{O("\u89E3\u6790\u4E2D...");let e=at(t),r=(0,Y.parseGIF)(e),n=(0,Y.decompressFrames)(r,!0);if(!n.length){O("\u65E0\u6709\u6548\u5E27"),f=[];return}F=r.lsd?.width||n[0].dims.width,q=r.lsd?.height||n[0].dims.height;let a=[],o=new Uint8ClampedArray(F*q*4),i=null;for(let l=0;l<n.length;l++){let c=n[l],p=c.disposalType;p===3?i=new Uint8ClampedArray(o):i=null;let w=new Uint8ClampedArray(o),{left:T,top:B,width:u,height:S}=c.dims,_=c.patch;for(let m=0;m<S;m++)for(let y=0;y<u;y++){let h=(m*u+y)*4,b=_[h+3];if(b===0)continue;let A=((B+m)*F+(T+y))*4;w[A]=_[h],w[A+1]=_[h+1],w[A+2]=_[h+2],w[A+3]=b}let N=new ImageData(w,F,q);switch(a.push({delay:Math.max(10,c.delay||0),imageData:N}),p){case 2:{let m=new Uint8ClampedArray(w);for(let y=0;y<S;y++)for(let h=0;h<u;h++){let b=((B+y)*F+(T+h))*4;m[b]=0,m[b+1]=0,m[b+2]=0,m[b+3]=0}o=m;break}case 3:{i?o=new Uint8ClampedArray(i):o=new Uint8ClampedArray(w);break}case 0:case 1:default:o=new Uint8ClampedArray(w)}}f=a,fe=f.reduce((l,c)=>l+c.delay,0),J.max=String(f.length-1),U.width=f[0].imageData.width,U.height=f[0].imageData.height,ge(),v=0,P();let s="";f.length>nt&&(s=" \u26A0\u5927\u91CF\u5E27, \u6027\u80FD\u53EF\u80FD\u4E0B\u964D"),O(`${f.length} \u5E27 / ${(fe/1e3).toFixed(2)}s${s}`),z||ae()}catch(e){console.error(e),O("\u89E3\u6790\u5931\u8D25")}}function P(){if(!f.length)return;let t=f[v];et.putImageData(t.imageData,0,0),J.value=String(v)}function ge(){if(!F||!q)return;let t=U.parentElement;if(!t)return;let e=t.clientWidth,r=t.clientHeight;if(e<=0||r<=0)return;let n=Math.min(e/F,r/q),a=Math.max(1,Math.floor(F*n)),o=Math.max(1,Math.floor(q*n));U.style.width=a+"px",U.style.height=o+"px"}var it=new ResizeObserver(ge);U.parentElement&&it.observe(U.parentElement);function ve(t){if(!z)return;G||(G=t);let e=t-G;G=t,Z+=e*x;let r=0;for(;Z>=f[v].delay&&(Z-=f[v].delay,v=(v+1)%f.length,r++,!(r>10)););P(),z&&(Q=requestAnimationFrame(ve))}function ae(){f.length&&(z=!0,ne.textContent="\u23F8",G=0,Z=0,Q=requestAnimationFrame(ve))}function L(){z=!1,ne.textContent="\u25B6",Q&&cancelAnimationFrame(Q)}ne.addEventListener("click",()=>{z?L():ae()});tt.addEventListener("click",()=>{L(),f.length&&(v=(v-1+f.length)%f.length,P())});rt.addEventListener("click",()=>{L(),f.length&&(v=(v+1)%f.length,P())});J.addEventListener("input",()=>{L(),v=Number(J.value),P()});I.addEventListener("change",()=>{let t=Number(I.value);t<.1?x=.1:t>4?x=4:x=t});window.addEventListener("message",t=>{let e=t.data;e.type==="reload"&&pe(e.data)});window.addEventListener("keydown",t=>{let e=t.target?.tagName;if(!(e==="INPUT"||e==="SELECT"||e==="TEXTAREA"||t.target?.isContentEditable)){if(t.code==="Space")t.preventDefault(),z?L():ae();else if(t.code==="ArrowLeft")t.preventDefault(),L(),f.length&&(v=(v-1+f.length)%f.length,P());else if(t.code==="ArrowRight")t.preventDefault(),L(),f.length&&(v=(v+1)%f.length,P());else if(t.code==="ArrowUp"){t.preventDefault();let r=Array.from(I.options).map(i=>Number(i.value)).sort((i,s)=>i-s),n=r.findIndex(i=>i>=x),a;n===-1?a=r[0]:r[n]===x?a=r[Math.min(r.length-1,n+1)]:a=r[n],x=a,Array.from(I.options).find(i=>Number(i.value)===x)&&(I.value=String(x))}else if(t.code==="ArrowDown"){t.preventDefault();let r=Array.from(I.options).map(i=>Number(i.value)).sort((i,s)=>i-s),n=r.findIndex(i=>i>=x),a;n===-1?a=r[0]:(r[n],a=r[Math.max(0,n-1)]),x=a,Array.from(I.options).find(i=>Number(i.value)===x)&&(I.value=String(x))}}});window.__initialGifBase64?pe(window.__initialGifBase64):Ye?.postMessage({type:"requestBytes"});window.__isLargeGif&&O((re.textContent?re.textContent+" ":"")+"\u26A0 \u6587\u4EF6\u8F83\u5927\uFF0C\u89E3\u6790\u53EF\u80FD\u8017\u65F6");})();
//# sourceMappingURL=main.js.map
