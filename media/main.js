"use strict";(()=>{var he=Object.create;var ie=Object.defineProperty;var be=Object.getOwnPropertyDescriptor;var xe=Object.getOwnPropertyNames;var we=Object.getPrototypeOf,Be=Object.prototype.hasOwnProperty;var H=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports);var Ae=(t,e,r,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let a of xe(e))!Be.call(t,a)&&a!==r&&ie(t,a,{get:()=>e[a],enumerable:!(n=be(e,a))||n.enumerable});return t};var Se=(t,e,r)=>(r=t!=null?he(we(t)):{},Ae(e||!t||!t.__esModule?ie(r,"default",{value:t,enumerable:!0}):r,t));var ee=H(I=>{"use strict";Object.defineProperty(I,"__esModule",{value:!0});I.loop=I.conditional=I.parse=void 0;var _e=function t(e,r){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:n;if(Array.isArray(r))r.forEach(function(i){return t(e,i,n,a)});else if(typeof r=="function")r(e,n,a,t);else{var o=Object.keys(r)[0];Array.isArray(r[o])?(a[o]={},t(e,r[o],n,a[o])):a[o]=r[o](e,n,a,t)}return n};I.parse=_e;var ke=function(e,r){return function(n,a,o,i){r(n,a,o)&&i(n,e,a,o)}};I.conditional=ke;var Ce=function(e,r){return function(n,a,o,i){for(var s=[],l=n.pos;r(n,a,o);){var c={};if(i(n,e,a,c),n.pos===l)break;l=n.pos,s.push(c)}return s}};I.loop=Ce});var te=H(g=>{"use strict";Object.defineProperty(g,"__esModule",{value:!0});g.readBits=g.readArray=g.readUnsigned=g.readString=g.peekBytes=g.readBytes=g.peekByte=g.readByte=g.buildStream=void 0;var Ee=function(e){return{data:e,pos:0}};g.buildStream=Ee;var oe=function(){return function(e){return e.data[e.pos++]}};g.readByte=oe;var Ie=function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return function(r){return r.data[r.pos+e]}};g.peekByte=Ie;var K=function(e){return function(r){return r.data.subarray(r.pos,r.pos+=e)}};g.readBytes=K;var Me=function(e){return function(r){return r.data.subarray(r.pos,r.pos+e)}};g.peekBytes=Me;var Ue=function(e){return function(r){return Array.from(K(e)(r)).map(function(n){return String.fromCharCode(n)}).join("")}};g.readString=Ue;var Fe=function(e){return function(r){var n=K(2)(r);return e?(n[1]<<8)+n[0]:(n[0]<<8)+n[1]}};g.readUnsigned=Fe;var Te=function(e,r){return function(n,a,o){for(var i=typeof r=="function"?r(n,a,o):r,s=K(e),l=new Array(i),c=0;c<i;c++)l[c]=s(n);return l}};g.readArray=Te;var Le=function(e,r,n){for(var a=0,o=0;o<n;o++)a+=e[r+o]&&Math.pow(2,n-o-1);return a},De=function(e){return function(r){for(var n=oe()(r),a=new Array(8),o=0;o<8;o++)a[7-o]=!!(n&1<<o);return Object.keys(e).reduce(function(i,s){var l=e[s];return l.length?i[s]=Le(a,l.index,l.length):i[s]=a[l.index],i},{})}};g.readBits=De});var se=H(X=>{"use strict";Object.defineProperty(X,"__esModule",{value:!0});X.default=void 0;var M=ee(),d=te(),W={blocks:function(e){for(var r=0,n=[],a=e.data.length,o=0,i=(0,d.readByte)()(e);i!==r&&i;i=(0,d.readByte)()(e)){if(e.pos+i>=a){var s=a-e.pos;n.push((0,d.readBytes)(s)(e)),o+=s;break}n.push((0,d.readBytes)(i)(e)),o+=i}for(var l=new Uint8Array(o),c=0,p=0;p<n.length;p++)l.set(n[p],c),c+=n[p].length;return l}},Pe=(0,M.conditional)({gce:[{codes:(0,d.readBytes)(2)},{byteSize:(0,d.readByte)()},{extras:(0,d.readBits)({future:{index:0,length:3},disposal:{index:3,length:3},userInput:{index:6},transparentColorGiven:{index:7}})},{delay:(0,d.readUnsigned)(!0)},{transparentColorIndex:(0,d.readByte)()},{terminator:(0,d.readByte)()}]},function(t){var e=(0,d.peekBytes)(2)(t);return e[0]===33&&e[1]===249}),ze=(0,M.conditional)({image:[{code:(0,d.readByte)()},{descriptor:[{left:(0,d.readUnsigned)(!0)},{top:(0,d.readUnsigned)(!0)},{width:(0,d.readUnsigned)(!0)},{height:(0,d.readUnsigned)(!0)},{lct:(0,d.readBits)({exists:{index:0},interlaced:{index:1},sort:{index:2},future:{index:3,length:2},size:{index:5,length:3}})}]},(0,M.conditional)({lct:(0,d.readArray)(3,function(t,e,r){return Math.pow(2,r.descriptor.lct.size+1)})},function(t,e,r){return r.descriptor.lct.exists}),{data:[{minCodeSize:(0,d.readByte)()},W]}]},function(t){return(0,d.peekByte)()(t)===44}),Ne=(0,M.conditional)({text:[{codes:(0,d.readBytes)(2)},{blockSize:(0,d.readByte)()},{preData:function(e,r,n){return(0,d.readBytes)(n.text.blockSize)(e)}},W]},function(t){var e=(0,d.peekBytes)(2)(t);return e[0]===33&&e[1]===1}),He=(0,M.conditional)({application:[{codes:(0,d.readBytes)(2)},{blockSize:(0,d.readByte)()},{id:function(e,r,n){return(0,d.readString)(n.blockSize)(e)}},W]},function(t){var e=(0,d.peekBytes)(2)(t);return e[0]===33&&e[1]===255}),Ge=(0,M.conditional)({comment:[{codes:(0,d.readBytes)(2)},W]},function(t){var e=(0,d.peekBytes)(2)(t);return e[0]===33&&e[1]===254}),qe=[{header:[{signature:(0,d.readString)(3)},{version:(0,d.readString)(3)}]},{lsd:[{width:(0,d.readUnsigned)(!0)},{height:(0,d.readUnsigned)(!0)},{gct:(0,d.readBits)({exists:{index:0},resolution:{index:1,length:3},sort:{index:4},size:{index:5,length:3}})},{backgroundColorIndex:(0,d.readByte)()},{pixelAspectRatio:(0,d.readByte)()}]},(0,M.conditional)({gct:(0,d.readArray)(3,function(t,e){return Math.pow(2,e.lsd.gct.size+1)})},function(t,e){return e.lsd.gct.exists}),{frames:(0,M.loop)([Pe,He,Ge,ze,Ne],function(t){var e=(0,d.peekByte)()(t);return e===33||e===44})}],Re=qe;X.default=Re});var le=H($=>{"use strict";Object.defineProperty($,"__esModule",{value:!0});$.deinterlace=void 0;var Oe=function(e,r){for(var n=new Array(e.length),a=e.length/r,o=function(L,x){var u=e.slice(x*r,(x+1)*r);n.splice.apply(n,[L*r,r].concat(u))},i=[0,4,2,1],s=[8,8,4,2],l=0,c=0;c<4;c++)for(var p=i[c];p<a;p+=s[c])o(p,l),l++;return n};$.deinterlace=Oe});var de=H(V=>{"use strict";Object.defineProperty(V,"__esModule",{value:!0});V.lzw=void 0;var je=function(e,r,n){var a=4096,o=-1,i=n,s,l,c,p,B,L,x,A,u,S,w,k,D,C,j,O,q=new Array(n),y=new Array(a),h=new Array(a),b=new Array(a+1);for(k=e,l=1<<k,B=l+1,s=l+2,x=o,p=k+1,c=(1<<p)-1,u=0;u<l;u++)y[u]=0,h[u]=u;var w,A,ye,D,C,O,j;for(w=A=ye=D=C=O=j=0,S=0;S<i;){if(C===0){if(A<p){w+=r[j]<<A,A+=8,j++;continue}if(u=w&c,w>>=p,A-=p,u>s||u==B)break;if(u==l){p=k+1,c=(1<<p)-1,s=l+2,x=o;continue}if(x==o){b[C++]=h[u],x=u,D=u;continue}for(L=u,u==s&&(b[C++]=D,u=x);u>l;)b[C++]=h[u],u=y[u];D=h[u]&255,b[C++]=D,s<a&&(y[s]=x,h[s]=D,s++,!(s&c)&&s<a&&(p++,c+=s)),x=L}C--,q[O++]=b[C],S++}for(S=O;S<i;S++)q[S]=0;return q};V.lzw=je});var ue=H(U=>{"use strict";Object.defineProperty(U,"__esModule",{value:!0});U.decompressFrames=U.decompressFrame=U.parseGIF=void 0;var Ke=Ze(se()),We=ee(),Xe=te(),$e=le(),Ve=de();function Ze(t){return t&&t.__esModule?t:{default:t}}var Je=function(e){var r=new Uint8Array(e);return(0,We.parse)((0,Xe.buildStream)(r),Ke.default)};U.parseGIF=Je;var Qe=function(e){for(var r=e.pixels.length,n=new Uint8ClampedArray(r*4),a=0;a<r;a++){var o=a*4,i=e.pixels[a],s=e.colorTable[i]||[0,0,0];n[o]=s[0],n[o+1]=s[1],n[o+2]=s[2],n[o+3]=i!==e.transparentIndex?255:0}return n},ce=function(e,r,n){if(!e.image){console.warn("gif frame does not have associated image.");return}var a=e.image,o=a.descriptor.width*a.descriptor.height,i=(0,Ve.lzw)(a.data.minCodeSize,a.data.blocks,o);a.descriptor.lct.interlaced&&(i=(0,$e.deinterlace)(i,a.descriptor.width));var s={pixels:i,dims:{top:e.image.descriptor.top,left:e.image.descriptor.left,width:e.image.descriptor.width,height:e.image.descriptor.height}};return a.descriptor.lct&&a.descriptor.lct.exists?s.colorTable=a.lct:s.colorTable=r,e.gce&&(s.delay=(e.gce.delay||10)*10,s.disposalType=e.gce.extras.disposal,e.gce.extras.transparentColorGiven&&(s.transparentIndex=e.gce.transparentColorIndex)),n&&(s.patch=Qe(s)),s};U.decompressFrame=ce;var Ye=function(e,r){return e.frames.filter(function(n){return n.image}).map(function(n){return ce(n,e.gct,r)})};U.decompressFrames=Ye});var Y=Se(ue()),pe=acquireVsCodeApi?.(),T=document.getElementById("canvas"),et=T.getContext("2d"),ne=document.getElementById("play"),tt=document.getElementById("prev"),rt=document.getElementById("next"),J=document.getElementById("progress"),_=document.getElementById("speed"),re=document.getElementById("info"),f=[],v=0,z=!1,m=window.__initialPlaybackSpeed&&!isNaN(window.__initialPlaybackSpeed)?Number(window.__initialPlaybackSpeed):1,Q=null,R=0,Z=0,fe=0,nt=2e3,F=0,G=0;function E(t){re.textContent=t}function at(t){let e=atob(t),r=e.length,n=new Uint8Array(r);for(let a=0;a<r;a++)n[a]=e.charCodeAt(a);return n.buffer}async function ge(t){try{E("\u89E3\u6790\u4E2D...");let e=at(t),r=(0,Y.parseGIF)(e),n=(0,Y.decompressFrames)(r,!0);if(!n.length){E("\u65E0\u6709\u6548\u5E27"),f=[];return}F=r.lsd?.width||n[0].dims.width,G=r.lsd?.height||n[0].dims.height;let a=[],o=new Uint8ClampedArray(F*G*4),i=null;for(let l=0;l<n.length;l++){let c=n[l],p=c.disposalType;p===3?i=new Uint8ClampedArray(o):i=null;let B=new Uint8ClampedArray(o),{left:L,top:x,width:u,height:S}=c.dims,k=c.patch;for(let y=0;y<S;y++)for(let h=0;h<u;h++){let b=(y*u+h)*4,w=k[b+3];if(w===0)continue;let A=((x+y)*F+(L+h))*4;B[A]=k[b],B[A+1]=k[b+1],B[A+2]=k[b+2],B[A+3]=w}let q=new ImageData(B,F,G);switch(a.push({delay:Math.max(10,c.delay||0),imageData:q}),p){case 2:{let y=new Uint8ClampedArray(B);for(let h=0;h<S;h++)for(let b=0;b<u;b++){let w=((x+h)*F+(L+b))*4;y[w]=0,y[w+1]=0,y[w+2]=0,y[w+3]=0}o=y;break}case 3:{i?o=new Uint8ClampedArray(i):o=new Uint8ClampedArray(B);break}case 0:case 1:default:o=new Uint8ClampedArray(B)}}f=a,fe=f.reduce((l,c)=>l+c.delay,0),J.max=String(f.length-1),T.width=f[0].imageData.width,T.height=f[0].imageData.height,me(),v=0,N();let s="";f.length>nt&&(s=" \u26A0\u5927\u91CF\u5E27, \u6027\u80FD\u53EF\u80FD\u4E0B\u964D"),E(`${f.length} \u5E27 / ${(fe/1e3).toFixed(2)}s${s}`),z||ae()}catch(e){console.error(e),E("\u89E3\u6790\u5931\u8D25")}}function N(){if(!f.length)return;let t=f[v];et.putImageData(t.imageData,0,0),J.value=String(v)}function me(){if(!F||!G)return;let t=T.parentElement;if(!t)return;let e=t.clientWidth,r=t.clientHeight;if(e<=0||r<=0)return;let n=Math.min(e/F,r/G),a=Math.max(1,Math.floor(F*n)),o=Math.max(1,Math.floor(G*n));T.style.width=a+"px",T.style.height=o+"px"}var it=new ResizeObserver(me);T.parentElement&&it.observe(T.parentElement);function ve(t){if(!z)return;R||(R=t);let e=t-R;R=t,Z+=e*m;let r=0;for(;Z>=f[v].delay&&(Z-=f[v].delay,v=(v+1)%f.length,r++,!(r>10)););N(),z&&(Q=requestAnimationFrame(ve))}function ae(){f.length&&(z=!0,ne.textContent="\u23F8",R=0,Z=0,Q=requestAnimationFrame(ve))}function P(){z=!1,ne.textContent="\u25B6",Q&&cancelAnimationFrame(Q)}ne.addEventListener("click",()=>{z?P():ae()});tt.addEventListener("click",()=>{P(),f.length&&(v=(v-1+f.length)%f.length,N())});rt.addEventListener("click",()=>{P(),f.length&&(v=(v+1)%f.length,N())});J.addEventListener("input",()=>{P(),v=Number(J.value),N()});_.addEventListener("change",()=>{let t=Number(_.value);t<.1?m=.1:t>4?m=4:m=t});window.addEventListener("message",t=>{let e=t.data;e.type==="reload"?ge(e.data):e.type==="copyResult"?e.ok||(E("\u590D\u5236\u5931\u8D25"),console.error(e.message)):e.type==="exportTemp"&&(async()=>{try{let r=e.data,n=e.name||"export-"+Date.now()+".gif",a=atob(r),o=new Uint8Array(a.length);for(let l=0;l<a.length;l++)o[l]=a.charCodeAt(l);let i=new Blob([o],{type:"image/gif"}),s=!1;if(navigator.clipboard&&window.ClipboardItem)try{let l=new window.ClipboardItem({"image/gif":i});await navigator.clipboard.write([l]),E("\u5DF2\u590D\u5236 GIF \u5230\u526A\u8D34\u677F: "+n),s=!0}catch(l){console.warn("clipboard gif write failed, fallback download",l)}if(!s){let l=URL.createObjectURL(i),c=document.createElement("a");c.href=l,c.download=n,document.body.appendChild(c),c.click(),setTimeout(()=>{URL.revokeObjectURL(l),c.remove()},2e3),E("\u5DF2\u4E0B\u8F7D GIF (\u526A\u8D34\u677F\u5199\u5165\u4E0D\u652F\u6301): "+n)}}catch(r){console.error("exportTemp failed",r),E("\u5BFC\u51FA\u5931\u8D25")}})()});window.addEventListener("keydown",t=>{let e=t.target?.tagName;if(!(e==="INPUT"||e==="SELECT"||e==="TEXTAREA"||t.target?.isContentEditable))if(t.code==="Space")t.preventDefault(),z?P():ae();else if(t.code==="ArrowLeft")t.preventDefault(),P(),f.length&&(v=(v-1+f.length)%f.length,N());else if(t.code==="ArrowRight")t.preventDefault(),P(),f.length&&(v=(v+1)%f.length,N());else if(t.code==="ArrowUp"){t.preventDefault();let r=Array.from(_.options).map(i=>Number(i.value)).sort((i,s)=>i-s),n=r.findIndex(i=>i>=m),a;n===-1?a=r[0]:r[n]===m?a=r[Math.min(r.length-1,n+1)]:a=r[n],m=a,Array.from(_.options).find(i=>Number(i.value)===m)&&(_.value=String(m))}else if(t.code==="ArrowDown"){t.preventDefault();let r=Array.from(_.options).map(i=>Number(i.value)).sort((i,s)=>i-s),n=r.findIndex(i=>i>=m),a;n===-1?a=r[0]:(r[n],a=r[Math.max(0,n-1)]),m=a,Array.from(_.options).find(i=>Number(i.value)===m)&&(_.value=String(m))}else(t.metaKey||t.ctrlKey)&&t.code==="KeyC"&&pe?.postMessage({type:"copyGif"})});window.__initialGifBase64?ge(window.__initialGifBase64):pe?.postMessage({type:"requestBytes"});var ot=Array.from(_.options).find(t=>Number(t.value)===m);ot&&(_.value=String(m));window.__isLargeGif&&E((re.textContent?re.textContent+" ":"")+"\u26A0 \u6587\u4EF6\u8F83\u5927\uFF0C\u89E3\u6790\u53EF\u80FD\u8017\u65F6");})();
//# sourceMappingURL=main.js.map
