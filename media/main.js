"use strict";(()=>{var be=Object.create;var le=Object.defineProperty;var we=Object.getOwnPropertyDescriptor;var Be=Object.getOwnPropertyNames;var Ae=Object.getPrototypeOf,Ce=Object.prototype.hasOwnProperty;var q=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports);var Se=(t,e,r,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let a of Be(e))!Ce.call(t,a)&&a!==r&&le(t,a,{get:()=>e[a],enumerable:!(n=we(e,a))||n.enumerable});return t};var _e=(t,e,r)=>(r=t!=null?be(Ae(t)):{},Se(e||!t||!t.__esModule?le(r,"default",{value:t,enumerable:!0}):r,t));var te=q(U=>{"use strict";Object.defineProperty(U,"__esModule",{value:!0});U.loop=U.conditional=U.parse=void 0;var ke=function t(e,r){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:n;if(Array.isArray(r))r.forEach(function(i){return t(e,i,n,a)});else if(typeof r=="function")r(e,n,a,t);else{var o=Object.keys(r)[0];Array.isArray(r[o])?(a[o]={},t(e,r[o],n,a[o])):a[o]=r[o](e,n,a,t)}return n};U.parse=ke;var Ee=function(e,r){return function(n,a,o,i){r(n,a,o)&&i(n,e,a,o)}};U.conditional=Ee;var Ie=function(e,r){return function(n,a,o,i){for(var s=[],d=n.pos;r(n,a,o);){var c={};if(i(n,e,a,c),n.pos===d)break;d=n.pos,s.push(c)}return s}};U.loop=Ie});var re=q(g=>{"use strict";Object.defineProperty(g,"__esModule",{value:!0});g.readBits=g.readArray=g.readUnsigned=g.readString=g.peekBytes=g.readBytes=g.peekByte=g.readByte=g.buildStream=void 0;var Ue=function(e){return{data:e,pos:0}};g.buildStream=Ue;var de=function(){return function(e){return e.data[e.pos++]}};g.readByte=de;var Me=function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return function(r){return r.data[r.pos+e]}};g.peekByte=Me;var K=function(e){return function(r){return r.data.subarray(r.pos,r.pos+=e)}};g.readBytes=K;var Le=function(e){return function(r){return r.data.subarray(r.pos,r.pos+e)}};g.peekBytes=Le;var Te=function(e){return function(r){return Array.from(K(e)(r)).map(function(n){return String.fromCharCode(n)}).join("")}};g.readString=Te;var Fe=function(e){return function(r){var n=K(2)(r);return e?(n[1]<<8)+n[0]:(n[0]<<8)+n[1]}};g.readUnsigned=Fe;var De=function(e,r){return function(n,a,o){for(var i=typeof r=="function"?r(n,a,o):r,s=K(e),d=new Array(i),c=0;c<i;c++)d[c]=s(n);return d}};g.readArray=De;var Pe=function(e,r,n){for(var a=0,o=0;o<n;o++)a+=e[r+o]&&Math.pow(2,n-o-1);return a},Ne=function(e){return function(r){for(var n=de()(r),a=new Array(8),o=0;o<8;o++)a[7-o]=!!(n&1<<o);return Object.keys(e).reduce(function(i,s){var d=e[s];return d.length?i[s]=Pe(a,d.index,d.length):i[s]=a[d.index],i},{})}};g.readBits=Ne});var ce=q(W=>{"use strict";Object.defineProperty(W,"__esModule",{value:!0});W.default=void 0;var M=te(),l=re(),X={blocks:function(e){for(var r=0,n=[],a=e.data.length,o=0,i=(0,l.readByte)()(e);i!==r&&i;i=(0,l.readByte)()(e)){if(e.pos+i>=a){var s=a-e.pos;n.push((0,l.readBytes)(s)(e)),o+=s;break}n.push((0,l.readBytes)(i)(e)),o+=i}for(var d=new Uint8Array(o),c=0,p=0;p<n.length;p++)d.set(n[p],c),c+=n[p].length;return d}},ze=(0,M.conditional)({gce:[{codes:(0,l.readBytes)(2)},{byteSize:(0,l.readByte)()},{extras:(0,l.readBits)({future:{index:0,length:3},disposal:{index:3,length:3},userInput:{index:6},transparentColorGiven:{index:7}})},{delay:(0,l.readUnsigned)(!0)},{transparentColorIndex:(0,l.readByte)()},{terminator:(0,l.readByte)()}]},function(t){var e=(0,l.peekBytes)(2)(t);return e[0]===33&&e[1]===249}),qe=(0,M.conditional)({image:[{code:(0,l.readByte)()},{descriptor:[{left:(0,l.readUnsigned)(!0)},{top:(0,l.readUnsigned)(!0)},{width:(0,l.readUnsigned)(!0)},{height:(0,l.readUnsigned)(!0)},{lct:(0,l.readBits)({exists:{index:0},interlaced:{index:1},sort:{index:2},future:{index:3,length:2},size:{index:5,length:3}})}]},(0,M.conditional)({lct:(0,l.readArray)(3,function(t,e,r){return Math.pow(2,r.descriptor.lct.size+1)})},function(t,e,r){return r.descriptor.lct.exists}),{data:[{minCodeSize:(0,l.readByte)()},X]}]},function(t){return(0,l.peekByte)()(t)===44}),He=(0,M.conditional)({text:[{codes:(0,l.readBytes)(2)},{blockSize:(0,l.readByte)()},{preData:function(e,r,n){return(0,l.readBytes)(n.text.blockSize)(e)}},X]},function(t){var e=(0,l.peekBytes)(2)(t);return e[0]===33&&e[1]===1}),Ge=(0,M.conditional)({application:[{codes:(0,l.readBytes)(2)},{blockSize:(0,l.readByte)()},{id:function(e,r,n){return(0,l.readString)(n.blockSize)(e)}},X]},function(t){var e=(0,l.peekBytes)(2)(t);return e[0]===33&&e[1]===255}),Re=(0,M.conditional)({comment:[{codes:(0,l.readBytes)(2)},X]},function(t){var e=(0,l.peekBytes)(2)(t);return e[0]===33&&e[1]===254}),Oe=[{header:[{signature:(0,l.readString)(3)},{version:(0,l.readString)(3)}]},{lsd:[{width:(0,l.readUnsigned)(!0)},{height:(0,l.readUnsigned)(!0)},{gct:(0,l.readBits)({exists:{index:0},resolution:{index:1,length:3},sort:{index:4},size:{index:5,length:3}})},{backgroundColorIndex:(0,l.readByte)()},{pixelAspectRatio:(0,l.readByte)()}]},(0,M.conditional)({gct:(0,l.readArray)(3,function(t,e){return Math.pow(2,e.lsd.gct.size+1)})},function(t,e){return e.lsd.gct.exists}),{frames:(0,M.loop)([ze,Ge,Re,qe,He],function(t){var e=(0,l.peekByte)()(t);return e===33||e===44})}],je=Oe;W.default=je});var ue=q(V=>{"use strict";Object.defineProperty(V,"__esModule",{value:!0});V.deinterlace=void 0;var $e=function(e,r){for(var n=new Array(e.length),a=e.length/r,o=function(T,b){var u=e.slice(b*r,(b+1)*r);n.splice.apply(n,[T*r,r].concat(u))},i=[0,4,2,1],s=[8,8,4,2],d=0,c=0;c<4;c++)for(var p=i[c];p<a;p+=s[c])o(p,d),d++;return n};V.deinterlace=$e});var fe=q(Z=>{"use strict";Object.defineProperty(Z,"__esModule",{value:!0});Z.lzw=void 0;var Ke=function(e,r,n){var a=4096,o=-1,i=n,s,d,c,p,B,T,b,A,u,C,w,k,F,E,$,j,H=new Array(n),v=new Array(a),h=new Array(a),x=new Array(a+1);for(k=e,d=1<<k,B=d+1,s=d+2,b=o,p=k+1,c=(1<<p)-1,u=0;u<d;u++)v[u]=0,h[u]=u;var w,A,xe,F,E,j,$;for(w=A=xe=F=E=j=$=0,C=0;C<i;){if(E===0){if(A<p){w+=r[$]<<A,A+=8,$++;continue}if(u=w&c,w>>=p,A-=p,u>s||u==B)break;if(u==d){p=k+1,c=(1<<p)-1,s=d+2,b=o;continue}if(b==o){x[E++]=h[u],b=u,F=u;continue}for(T=u,u==s&&(x[E++]=F,u=b);u>d;)x[E++]=h[u],u=v[u];F=h[u]&255,x[E++]=F,s<a&&(v[s]=b,h[s]=F,s++,!(s&c)&&s<a&&(p++,c+=s)),b=T}E--,H[j++]=x[E],C++}for(C=j;C<i;C++)H[C]=0;return H};Z.lzw=Ke});var ge=q(L=>{"use strict";Object.defineProperty(L,"__esModule",{value:!0});L.decompressFrames=L.decompressFrame=L.parseGIF=void 0;var Xe=Qe(ce()),We=te(),Ve=re(),Ze=ue(),Je=fe();function Qe(t){return t&&t.__esModule?t:{default:t}}var Ye=function(e){var r=new Uint8Array(e);return(0,We.parse)((0,Ve.buildStream)(r),Xe.default)};L.parseGIF=Ye;var et=function(e){for(var r=e.pixels.length,n=new Uint8ClampedArray(r*4),a=0;a<r;a++){var o=a*4,i=e.pixels[a],s=e.colorTable[i]||[0,0,0];n[o]=s[0],n[o+1]=s[1],n[o+2]=s[2],n[o+3]=i!==e.transparentIndex?255:0}return n},pe=function(e,r,n){if(!e.image){console.warn("gif frame does not have associated image.");return}var a=e.image,o=a.descriptor.width*a.descriptor.height,i=(0,Je.lzw)(a.data.minCodeSize,a.data.blocks,o);a.descriptor.lct.interlaced&&(i=(0,Ze.deinterlace)(i,a.descriptor.width));var s={pixels:i,dims:{top:e.image.descriptor.top,left:e.image.descriptor.left,width:e.image.descriptor.width,height:e.image.descriptor.height}};return a.descriptor.lct&&a.descriptor.lct.exists?s.colorTable=a.lct:s.colorTable=r,e.gce&&(s.delay=(e.gce.delay||10)*10,s.disposalType=e.gce.extras.disposal,e.gce.extras.transparentColorGiven&&(s.transparentIndex=e.gce.transparentColorIndex)),n&&(s.patch=et(s)),s};L.decompressFrame=pe;var tt=function(e,r){return e.frames.filter(function(n){return n.image}).map(function(n){return pe(n,e.gct,r)})};L.decompressFrames=tt});var ee=_e(ge()),ye=acquireVsCodeApi?.(),ae=document.getElementById("canvas"),rt=ae.getContext("2d"),oe=document.getElementById("play"),nt=document.getElementById("prev"),at=document.getElementById("next"),Q=document.getElementById("progress"),S=document.getElementById("speed"),D=document.getElementById("info"),O=document.getElementById("loadingOverlay"),_=document.getElementById("frameCounter");function ie(t="\u52A0\u8F7D\u4E2D..."){if(O){let e=O.querySelector(".loading-text");e&&(e.textContent=t),O.style.display="flex"}}function it(){O&&(O.style.display="none")}var f=[],m=0,N=!1,y=window.__initialPlaybackSpeed&&!isNaN(window.__initialPlaybackSpeed)?Number(window.__initialPlaybackSpeed):1,Y=null,R=0,J=0,me=0,ot=2e3,G=0,ne=0;function I(t){D.textContent=t}function st(t){let e=atob(t),r=e.length,n=new Uint8Array(r);for(let a=0;a<r;a++)n[a]=e.charCodeAt(a);return n.buffer}async function ve(t){try{ie("\u89E3\u6790\u4E2D..."),I("\u89E3\u6790\u4E2D...");let e=st(t),r=(0,ee.parseGIF)(e),n=(0,ee.decompressFrames)(r,!0);if(!n.length){I("\u65E0\u6709\u6548\u5E27"),f=[],_&&(_.textContent="-- / --");return}G=r.lsd?.width||n[0].dims.width,ne=r.lsd?.height||n[0].dims.height;let a=[],o=new Uint8ClampedArray(G*ne*4),i=null;for(let d=0;d<n.length;d++){let c=n[d],p=c.disposalType;p===3?i=new Uint8ClampedArray(o):i=null;let B=new Uint8ClampedArray(o),{left:T,top:b,width:u,height:C}=c.dims,k=c.patch;for(let v=0;v<C;v++)for(let h=0;h<u;h++){let x=(v*u+h)*4,w=k[x+3];if(w===0)continue;let A=((b+v)*G+(T+h))*4;B[A]=k[x],B[A+1]=k[x+1],B[A+2]=k[x+2],B[A+3]=w}let H=new ImageData(B,G,ne);switch(a.push({delay:Math.max(10,c.delay||0),imageData:H}),p){case 2:{let v=new Uint8ClampedArray(B);for(let h=0;h<C;h++)for(let x=0;x<u;x++){let w=((b+h)*G+(T+x))*4;v[w]=0,v[w+1]=0,v[w+2]=0,v[w+3]=0}o=v;break}case 3:{i?o=new Uint8ClampedArray(i):o=new Uint8ClampedArray(B);break}case 0:case 1:default:o=new Uint8ClampedArray(B)}}f=a,me=f.reduce((d,c)=>d+c.delay,0),Q.max=String(f.length-1),ae.width=f[0].imageData.width,ae.height=f[0].imageData.height,m=0,z();let s="";f.length>ot&&(s=" \u26A0\u5927\u91CF\u5E27, \u6027\u80FD\u53EF\u80FD\u4E0B\u964D"),I(`${f.length} \u5E27 / ${(me/1e3).toFixed(2)}s${s}`),N||se(),_&&(_.textContent=`1 / ${f.length}`),it()}catch(e){console.error(e),I("\u89E3\u6790\u5931\u8D25"),ie("\u89E3\u6790\u5931\u8D25"),_&&(_.textContent="-- / --")}}function z(){if(!f.length)return;let t=f[m];rt.putImageData(t.imageData,0,0),Q.value=String(m),_&&(_.textContent=`${m+1} / ${f.length}`)}function he(t){if(!N)return;R||(R=t);let e=t-R;R=t,J+=e*y;let r=0;for(;J>=f[m].delay&&(J-=f[m].delay,m=(m+1)%f.length,r++,!(r>10)););z(),N&&(Y=requestAnimationFrame(he))}function se(){f.length&&(N=!0,oe.textContent="\u23F8",R=0,J=0,Y=requestAnimationFrame(he))}function P(){N=!1,oe.textContent="\u25B6",Y&&cancelAnimationFrame(Y)}oe.addEventListener("click",()=>{N?P():se()});nt.addEventListener("click",()=>{P(),f.length&&(m=(m-1+f.length)%f.length,z())});at.addEventListener("click",()=>{P(),f.length&&(m=(m+1)%f.length,z())});Q.addEventListener("input",()=>{P(),m=Number(Q.value),z()});S.addEventListener("change",()=>{let t=Number(S.value);t<.1?y=.1:t>4?y=4:y=t});window.addEventListener("message",t=>{let e=t.data;e.type==="reload"?ve(e.data):e.type==="copyResult"?e.ok||(I("\u590D\u5236\u5931\u8D25"),console.error(e.message)):e.type==="exportTemp"&&(async()=>{try{let r=atob(e.data),n=r.length,a=new Uint8Array(n);for(let s=0;s<n;s++)a[s]=r.charCodeAt(s);let o=new Blob([a],{type:"image/gif"});if(navigator.clipboard&&window.ClipboardItem)try{await navigator.clipboard.write([new ClipboardItem({"image/gif":o})]),I((D.textContent?D.textContent+" ":"")+"\u5DF2\u590D\u5236\u56FE\u50CF");return}catch(s){console.warn("clipboard image write failed, fallback to download",s)}let i=document.createElement("a");i.href=URL.createObjectURL(o),i.download=e.name||"image.gif",document.body.appendChild(i),i.click(),i.remove(),setTimeout(()=>URL.revokeObjectURL(i.href),2e3),I((D.textContent?D.textContent+" ":"")+"\u5DF2\u4E0B\u8F7D")}catch(r){console.error("exportTemp handling failed",r),I("\u5BFC\u51FA\u5931\u8D25")}})()});window.addEventListener("keydown",t=>{let e=t.target?.tagName;if(!(e==="INPUT"||e==="SELECT"||e==="TEXTAREA"||t.target?.isContentEditable))if(t.code==="Space")t.preventDefault(),N?P():se();else if(t.code==="ArrowLeft")t.preventDefault(),P(),f.length&&(m=(m-1+f.length)%f.length,z());else if(t.code==="ArrowRight")t.preventDefault(),P(),f.length&&(m=(m+1)%f.length,z());else if(t.code==="ArrowUp"){t.preventDefault();let r=Array.from(S.options).map(i=>Number(i.value)).sort((i,s)=>i-s),n=r.findIndex(i=>i>=y),a;n===-1?a=r[0]:r[n]===y?a=r[Math.min(r.length-1,n+1)]:a=r[n],y=a,Array.from(S.options).find(i=>Number(i.value)===y)&&(S.value=String(y))}else if(t.code==="ArrowDown"){t.preventDefault();let r=Array.from(S.options).map(i=>Number(i.value)).sort((i,s)=>i-s),n=r.findIndex(i=>i>=y),a;n===-1?a=r[0]:(r[n],a=r[Math.max(0,n-1)]),y=a,Array.from(S.options).find(i=>Number(i.value)===y)&&(S.value=String(y))}else(t.metaKey||t.ctrlKey)&&t.code==="KeyC"&&ye?.postMessage({type:"copyGif"})});window.__initialGifBase64?ve(window.__initialGifBase64):(ie("Loading..."),ye?.postMessage({type:"requestBytes"}),_&&(_.textContent="-- / --"));var lt=Array.from(S.options).find(t=>Number(t.value)===y);lt&&(S.value=String(y));window.__isLargeGif&&I((D.textContent?D.textContent+" ":"")+"\u26A0 \u6587\u4EF6\u8F83\u5927\uFF0C\u89E3\u6790\u53EF\u80FD\u8017\u65F6");})();
//# sourceMappingURL=main.js.map
